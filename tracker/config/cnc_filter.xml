<filter name='sandbox-cnc-filter'>
  <filterref filter='sandbox-default-filter'/>
  <!-- give high priority so is not blocked by connection limitation -->
  <rule action='accept' direction='out' priority='700'>
    <tcp srcipaddr='$SANDBOX_IP' dstipaddr='$CNC_IP'/>
  </rule>
  <rule action='accept' direction='in' priority='700'>
    <tcp srcipaddr='$CNC_IP'/>
  </rule>
  
  <!-- allow connection limit -->
  <rule action='drop' direction='out' priority='800'>
    <tcp connlimit-above='$CONN_LIMIT'/>
  </rule>

  <!-- allow or drop on tcp ports -->
  <rule action='accept' direction='out' priority='900'>
    <tcp dstportstart='$TCP_PORT[@1]' dstipfrom='$SERVER_IP_S[@1]' dstipto='$SERVER_IP_E[@1]'/>
  </rule>
</filter>
